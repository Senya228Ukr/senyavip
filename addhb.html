<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8"/>
    <title>Добавить HackTheBox публикацию</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link rel="stylesheet" href="global.css"/>
    <link rel="stylesheet" href="styles.css"/>
</head>

<body>

<div class="container">
    <h1>Добавить публикацию</h1>

    <form class="card" id="postForm">
        <div class="card-content">

            <input id="title" placeholder="Заголовок" class="input" required />

            <input id="link" placeholder="Ссылка (https://...)" class="input" required />

            <button class="btn-primary glow shimmer" type="submit">Сохранить</button>
            <a class="btn-ghost" href="hb.html">К списку</a>
        </div>
    </form>
</div>

<!-- Firebase init -->
<script type="module" src="firebase-init.js"></script>

<script type="module">
import { collection, addDoc, serverTimestamp }
    from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const form = document.getElementById("postForm");
const titleInput = document.getElementById("title");
const linkInput = document.getElementById("link");

form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const title = titleInput.value.trim();
    const link = linkInput.value.trim();

    if (!title || !link) {
        alert("Заполните все поля.");
        return;
    }

    try {
        // Добавляем публикацию в Firestore
        await addDoc(collection(window.db, "hackthebox"), {
            title: title,
            link: link,
            createdAt: serverTimestamp()
        });

        alert("Публикация добавлена!");
        window.location.href = "hb.html";

    } catch (err) {
        console.error(err);
        alert("Ошибка при сохранении.");
    }
});
</script>

</body>
</html>
