<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8"/>
    <title>HackTheBox — Публикации</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link rel="stylesheet" href="global.css"/>
    <link rel="stylesheet" href="styles.css"/>
</head>

<body>

<div class="container">

    <div class="header">
        <h1>HackTheBox — Публикации</h1>
    </div>

    <nav class="nav">
        <a href="index.html">home</a>
    </nav>

    <div class="grid cols-2" id="list"></div>
</div>

<!-- Firebase init -->
<script type="module" src="firebase-init.js"></script>

<script type="module">
import {
    collection,
    getDocs,
    query,
    orderBy
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const root = document.getElementById("list");

async function loadPosts() {
    root.innerHTML = "<p>Загрузка...</p>";

    const q = query(
        collection(window.db, "hackthebox"),
        orderBy("createdAt", "desc")
    );

    const snapshot = await getDocs(q);

    if (snapshot.empty) {
        root.innerHTML = "<p>Пока нет публикаций.</p>";
        return;
    }

    root.innerHTML = "";

    snapshot.forEach(doc => {
        const item = doc.data();

        const card = document.createElement("div");
        card.className = "card reveal";

        // Заголовок
        const head = document.createElement("div");
        head.className = "card-header";
        head.textContent = item.title || "Без названия";
        card.appendChild(head);

        // Контент
        const body = document.createElement("div");
        body.className = "card-content";

        // кнопка «Открыть»
        if (item.link) {
            const btn = document.createElement("a");
            btn.href = item.link;
            btn.textContent = "Открыть";
            btn.target = "_blank";
            btn.rel = "noopener";
            btn.className = "btn-primary glow shimmer";
            body.appendChild(btn);
        }

        // Дата
        if (item.createdAt && item.createdAt.toDate) {
            const p = document.createElement("p");
            const date = item.createdAt.toDate();
            p.textContent = `Добавлено: ${date.toLocaleString("ru-RU")}`;
            p.style.color = "var(--muted)";
            p.style.fontSize = "0.85rem";
            p.style.marginTop = "12px";
            body.appendChild(p);
        }

        card.appendChild(body);

        root.appendChild(card);
    });
}

loadPosts();
</script>

</body>
</html>
